
const programs = {

    Coaching3: ["Combi10", "Combi11", "Combi12", "Combi13", "Combi14"],
    Coaching4: ["P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8", "P9", "P10", "P11", "P12", "P13", "P14", "P15", "P16", "P17", "P18", "P19", "P20", "P21", "P22", "P23", "P24", "P25", "P26", "P27", "P28", "P29", "P30", "P31", "P32", "P33", "P34", "P35", "P36"],
    
    };
   
  
    const descriptions = {
    
    
    Coaching3:
    { 
    "P1.1": " Hands on 1 et 2 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P2.1": " Hands on 1 et 4 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P3.1": " Hands on 2 et 3 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    
    "P4.1": " Hands on 1 et 6 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P5.1": " Hands on 2 et 5 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P6.1": " Hands on 3 et 4 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    
    
    "P7.1": " Hands on 1 et 8 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P8.1": " Hands on 2 et 7 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P9.1": " Hands on 3 et 6 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P10.1":" Hands on 4 et 5 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    
    
    
    "P11.1": " Hands on 1 et 10 :Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P12.1": " Hands on 2 et 9 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P13.1": " Hands on 3 et 8 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P14.1": " Hands on 4 et 7 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P15.1": " Hands on 5 et 6 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    
    
    "P16.1": " Hands on 1 et 12 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P17.1": " Hands on 2 et 11 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P18.1": " Hands on 3 et 10 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P19.1": " Hands on 4 et 9 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P20.1": " Hands on 5 et 8 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P21.1": " Hands on 6 et 7 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    
    
    "P22.1": " Hands on 3 et 12 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P23.1": " Hands on 4 et 11 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P24.1": " Hands on 5 et 10 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P25.1": " Hands on 6 et 9 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P26.1": " Hands on 7 et 8 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    
    
    "P27.1": " Hands on 5 et 12 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P28.1": " Hands on 6 et 11 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P29.1": " Hands on 7 et 10 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P30.1": " Hands on 8 et 9 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    
    
    
    
    "P31.1": " Hands on 7 et 12 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P32.1": " Hands on 8 et 11 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    "P33.1": " Hands on 9 et 10 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    
    
    "P34.1": " Hands on 9 et 12 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints",
    "P35.1": " Hands on 10 et 11 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    
    "P36.1": " Hands on 11 et 12 : Forearm on the ground or arm extended, aligned in front of the mat, straight back, engage the abs, hands covering the imprints ",
    
    },
    
    Coaching4: 
    { 
    
    "way1": " Hand's way n°1",
    "way2": "Hand's way n°2",
    "way3": "Hand's way n°3",
    "way4": "Hand's way n°4",
    "way5": " Hand's way n°5",
    "way6": "Hand's way n°6",
    "way7": "Hand's way n°7",
    "way8": "Hand's way n°8",
    "way9": " Hand's way n°9",
    "way10": "Hand's way n°10",
    "way11": "Hand's way n°11",
    "way12": "Hand's way n°12",
    "way13": " Hand's way n°13",
    "way14": "Hand's way n°14",
    "way15": "Hand's way n°15",
    "way16": "Hand's way n°16",
    "way17": " Hand's way n°17",
    "way18": "Hand's way n°18",
    "way19": "Hand's way n°19",
    "way20": "Hand's way n°20",
    "way21": " Hand's way n°21",
    "way22": "Hand's way n°22",
    "way23": "Hand's way n°23",
    "way24": "Hand's way n°24",
    "way25": " Hand's way n°25",
    "way26": "Hand's way n°26",
    "way27": "Hand's way n°27",
    "way28": "Hand's way n°28",
    "way29": " Hand's way n°29",
    "way30": "Hand's way n°30",
    "way31": "Hand's way n°31",
    "way32": "Hand's way n°32",
    "way33": " Hand's way n°33",
    "way34": "Hand's way n°34",
    "way35": "Hand's way n°35",
    "way36": "Hand's way n°36",
    
    
    "P1": " Way1 : Hands on 1 et 2 : 3 push-ups with straight arms, option to have knees on the ground ",
    "P2": " Way2 : Hands on 1 et 4 : 5 push-ups with straight arms, option to have knees on the ground ",
    "P3": " Way3 : Hands on 2 et 3 : 5 push-ups with straight arms, option to have knees on the ground ",
    
    "P4": " Way4 : Hands on 1 et 6 : 7 push-ups with straight arms, option to have knees on the ground ",
    "P5": " Way5 : Hands on 2 et 5 : 7 push-ups with straight arms, option to have knees on the ground ",
    "P6": " Way6 : Hands on 3 et 4 : 7 push-ups with straight arms, option to have knees on the ground ",
    
    
    "P7": " Way7 : Hands on 1 et 8 : 9 push-ups with straight arms, option to have knees on the ground ",
    "P8": " Way8 : Hands on 2 et 7 : 9 push-ups with straight arms, option to have knees on the ground ",
    "P9": " Way9 : Hands on 3 et 6 : 9 push-ups with straight arms, option to have knees on the ground ",
    "P10":" Way10 : Hands on 4 et 5 : 9 push-ups with straight arms, option to have knees on the ground ",
    
    
    
    "P11": " Way11 : Hands on 1 et 10 : 11 push-ups with straight arms, option to have knees on the ground ",
    "P12": " Way12 : Hands on 2 et 9 : 11 push-ups with straight arms, option to have knees on the ground ",
    "P13": " Way13 : Hands on 3 et 8 : 11 push-ups with straight arms, option to have knees on the ground ",
    "P14": " Way14 : Hands on 4 et 7 : 11 push-ups with straight arms, option to have knees on the ground ",
    "P15": " Way15 : Hands on 5 et 6 : 11 push-ups with straight arms, option to have knees on the ground ",
    
    
    "P16": " Way16 : Hands on 1 et 12 : 13 push-ups with straight arms, option to have knees on the ground ",
    "P17": " Way17 : Hands on 2 et 11 : 13 push-ups with straight arms, option to have knees on the ground k",
    "P18": " Way18 : Hands on 3 et 10 : 13 push-ups with straight arms, option to have knees on the ground ",
    "P19": " Way19 : Hands on 4 et 9 : 13 push-ups with straight arms, option to have knees on the ground ",
    "P20": " Way20 : Hands on 5 et 8 : 13 push-ups with straight arms, option to have knees on the ground ",
    "P21": " Way21 : Hands on 6 et 7 : 13 push-ups with straight arms, option to have knees on the ground ",
    
    
    "P22": " Way22 : Hands on 3 et 12 : 15 push-ups with straight arms, option to have knees on the ground ",
    "P23": " Way23 : Hands on 4 et 11 : 15 push-ups with straight arms, option to have knees on the ground ",
    "P24": " Way24 : Hands on 5 et 10 : 15 push-ups with straight arms, option to have knees on the ground ",
    "P25": " Way25 : Hands on 6 et 9 : 15 push-ups with straight arms, option to have knees on the ground ",
    "P26": " Way26 : Hands on 7 et 8 : 15 Ppush-ups with straight arms, option to have knees on the ground ",
    
    
    "P27": " Way27 : Hands on 5 et 12 : 17 push-ups with straight arms, option to have knees on the ground ",
    "P28": " Way28 : Hands on 6 et 11 : 17 push-ups with straight arms, option to have knees on the ground ",
    "P29": " Way29 : Hands on 7 et 10 : 17 push-ups with straight arms, option to have knees on the ground ",
    "P30": " Way30 : Hands on 8 et 9 : 17 push-ups with straight arms, option to have knees on the ground ",
    
    
    
    
    "P31": " Way31 : Hands on 7 et 12 : 19 push-ups with straight arms, option to have knees on the ground ",
    "P32": " Way32 : Hands on 8 et 11 : 19 push-ups with straight arms, option to have knees on the ground ",
    "P33": " Way33 : Hands on 9 et 10 : 19 push-ups with straight arms, option to have knees on the ground ",
    
    
    "P34": " Way34 : Hands on 9 et 12 : 21 push-ups with straight arms, option to have knees on the ground ",
    "P35": " Way35 : Hands on 10 et 11 : 21 push-ups with straight arms, option to have knees on the ground ",
    
    "P36": " Way36 : Hands on 11 et 12 : 23 push-ups with straight arms, option to have knees on the ground ",
    
    
    },
    
    };
    let filesAvailable = JSON.parse(JSON.stringify(programs));
    let filesPlayed = {
        Coaching3: [],
        Coaching4: [],
    };
    
    let currentCombination = [];
    let isAudioPlaying = false;
    let currentAudioIndex = 0;
    let currentAudio = new Audio();
    let isLastWaysPlayed = false;
    let audioContext;
    let bellSoundBuffer;
    let timerDuration;
    let intervalCoaching3;
    let currentAudioCoaching3 = new Audio();
    let audioKeys = ["P1.1", "P3.1", "P4.1", "P5.1", "P6.1", "P7.1", "P8.1", "P9.1", "P10.1", "P11.1", "P12.1", "P13.1", "P14.1", "P15.1", "P16.1", "P17.1", "P18.1", "P19.1", "P20.1","P21.1", "P22.1", "P23.1", "P24.1", "P25.1", "P26.1", "P27.1", "P28.1", "P29.1", "P30.1","P31.1", "P32.1", "P33.1", "P34.1", "P35.1", "P36.1"];
    let audioIndex = 0;
    let isPaused = false;
    let remainingTime = 0;
    let upcomingAudioTimeout;
    document.addEventListener('DOMContentLoaded', () => {
        initializeAudioContext();
        loadBellSound();
        setupEventListeners();
        resetTimeSelector();
    });
    
    function debugLog(message) {
        console.log(`DEBUG: ${message}`);
    }
    
    function initializeAudioContext() {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    function loadBellSound() {
        return fetch('audio/cloche.mp3')
            .then(response => response.arrayBuffer())
            .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
            .then(audioBuffer => {
                bellSoundBuffer = audioBuffer;
            })
            .catch(e => console.error('Error loading bell sound:', e));
    }
    
    function playBellSound() {
        if (bellSoundBuffer) {
            const source = audioContext.createBufferSource();
            source.buffer = bellSoundBuffer;
            source.connect(audioContext.destination);
            source.start();
        }
    }
    
    function setupEventListeners() {
        setupReturnToMenuButtonCoaching3();
        setupReturnToMenuButtonCoaching4();
        setupProgramSelector();
        setupPompesSelector();
        setupGoButton();
        setupStopButton();
        setupNextButton();
        setupNextAudioButton();
        setupRetourneMenueButton();
        debugLog("Event listeners configured");
    }
    
    function setupProgramSelector() {
        const programSelect = document.getElementById('programSelect');
        programSelect.addEventListener('change', handleProgramChange);
        console.log('Program selector setup complete');
    }
    
    function handleProgramChange() {
        debugLog(`Program changed to: ${this.value}`);
        resetUI(true);
    
        switch (this.value) {
            case 'Coaching3':
                initializeCoaching3UI();
                document.getElementById('programSelect').style.display = 'none';
                break;
            case 'Coaching4':
                initializeCoaching4UI();
                break;
            default:
                document.getElementById('retourneMenue').style.display = 'none';
                break;
        }
    }
    
    function setupNextButton() {
        const nextButton = document.getElementById('nextButton');
        nextButton.addEventListener('click', handleNextButtonClick);
    }
    
    function handleNextButtonClick() {
        toggleDisplay('welcomeVideo', false);
        toggleDisplay('videoDescription', false);
        toggleDisplay('tapisImage', false);
        toggleDisplay('pompesSelectorContainer', true);
        
    
        const pompesSelector = document.getElementById('pompesSelector');
        pompesSelector.selectedIndex = 0;
        document.getElementById('pompesInstruction').style.display = 'none';
        document.getElementById('startButton').style.display = 'none';
    
        const returnButton = document.getElementById('returnButtonCoaching4');
        if (returnButton) {
            returnButton.style.display = 'block';
        }
    }
    
    function toggleDisplay(elementId, isVisible) {
        const element = document.getElementById(elementId);
        if (element) {
            element.style.display = isVisible ? 'block' : 'none';
            console.log(`${elementId} ${isVisible ? 'displayed' : 'hidden'}`);
        } else {
            console.log(`${elementId} not found`);
        }
    }
    
    function setupPompesSelector() {
        const pompesSelector = document.getElementById('pompesSelector');
        pompesSelector.addEventListener('change', function() {
            handlePompesSelectorChange(this.value);
        });
    }
    
    async function handlePompesSelectorChange(value) {
        if (value) {
            await calculateProgramCombinations(parseInt(value, 10));
            toggleDisplay('tapisImage', false);
            toggleDisplay('pompesInstruction', true);
            toggleDisplay('startButton', true);
            toggleDisplay('returnButtonCoaching4', true);
        }
    }
    
    async function calculateProgramCombinations(targetPompes) {
        const pumpsMapping = {
            'P1': 3, 'P2': 5, 'P3': 5, 'P4': 7, 'P5': 7, 'P6': 7, 'P7': 9, 'P8': 9, 'P9': 9, 'P10': 9,
            'P11': 11, 'P12': 11, 'P13': 11, 'P14': 11, 'P15': 11, 'P16': 13, 'P17': 13, 'P18': 13, 'P19': 13,
            'P20': 13, 'P21': 13, 'P22': 15, 'P23': 15, 'P24': 15, 'P25': 15, 'P26': 15, 'P27': 17, 'P28': 17,
            'P29': 17, 'P30': 17, 'P31': 19, 'P32': 19, 'P33': 19, 'P34': 21, 'P35': 21, 'P36': 23
        };
        let cumulativePumps = 0;
        let selectedPrograms = [];
        for (let key in pumpsMapping) {
            cumulativePumps += pumpsMapping[key];
            selectedPrograms.push(key);
            if (cumulativePumps >= targetPompes) break;
        }
    
        if (selectedPrograms.length > 0) {
            currentCombination = selectedPrograms;
            currentAudioIndex = 0;
            isLastWaysPlayed = false;
            document.getElementById('pompesInstruction').textContent = `We have selected the programs ${currentCombination.join(', ')} to perform your ${targetPompes} push-ups.`;
        } else {
            displayNoCombinationFound();
        }
    }
    
    function setupGoButton() {
        const startButton = document.getElementById('startButton');
        startButton.addEventListener('click', async function() {
            const pompes = parseInt(document.getElementById('pompesSelector').value, 10);
            await calculateProgramCombinations(pompes);
            playInitialAudio();
            this.style.display = 'none';
        });
    }
    
    async function playInitialAudio() {
        if (!isAudioPlaying) {
            isAudioPlaying = true;
    
            const wayAudioPath = `./audio/way${currentAudioIndex + 1}.mp3`;
            const programAudioPath = `./audio/${currentCombination[currentAudioIndex]}.mp3`;
    
            await playAudio(wayAudioPath);
            updateUIForAudioPlay(descriptions.Coaching4[`way${currentAudioIndex + 1}`], true);
    
            await playAudio(programAudioPath);
            updateUIForAudioPlay(descriptions.Coaching4[currentCombination[currentAudioIndex]], true);
    
            if (currentAudioIndex === currentCombination.length - 1) {
                isAudioPlaying = false;
                updateAudioControlButtons(true);
            } else {
                currentAudioIndex++;
                isAudioPlaying = false;
                updateAudioControlButtons(false);
            }
        } else {
            console.log("Audio is currently playing or no more audio to play.");
        }
    }
    
    async function playCoaching4Audio() {
        if (!isAudioPlaying) {
            isAudioPlaying = true;
            try {
                const wayAudioPath = `./audio/way${currentAudioIndex + 1}.mp3`;
                const programPath = `./audio/${currentCombination[currentAudioIndex]}.mp3`;
    
                await playAudio(wayAudioPath);
                updateUIForAudioPlay(descriptions.Coaching4[`way${currentAudioIndex + 1}`], true);
    
                if (currentAudioIndex === currentCombination.length - 1) {
                    await playAudio('./audio/Lastways.mp3');
                    updateUIForAudioPlay("Closing session with Lastways.", true);
    
                    await playAudio(programPath);
                    updateUIForAudioPlay(descriptions.Coaching4[currentCombination[currentAudioIndex]], true);
    
                    isLastWaysPlayed = true;
                    isAudioPlaying = false;
                    updateAudioControlButtons(true);
                } else {
                    await playAudio(programPath);
                    updateUIForAudioPlay(descriptions.Coaching4[currentCombination[currentAudioIndex]], true);
    
                    currentAudioIndex++;
                    isAudioPlaying = false;
                    updateAudioControlButtons(false);
                }
            } catch (error) {
                console.error("Error playing sequence: ", error);
                updateUIForAudioPlay("Erreur de lecture. Veuillez vérifier les fichiers audio.", false);
                isAudioPlaying = false;
            }
        } else {
            console.log("Audio is currently playing or no more audio to play.");
        }
    }
    
    function updateUIForAudioPlay(description, isVisible) {
        const audioDescription = document.getElementById('audioDescription');
        audioDescription.textContent = description;
        audioDescription.classList.add('text-description');
        audioDescription.style.display = isVisible ? 'block' : 'none';
        document.getElementById('tapisImage').style.display = 'none'; 
    }
    
    function updateAudioControlButtons(isLastAudio) {
        const nextAudioButton = document.getElementById('nextAudioButton');
        const returnButton = document.getElementById('returnButtonCoaching4');
    
        if (isLastAudio) {
            nextAudioButton.style.display = 'none';
        } else {
            nextAudioButton.style.display = 'block';
        }
        returnButton.style.display = 'block';
        nextAudioButton.onclick = playCoaching4Audio;
    }
    
    async function playAudio(audioPath) {
        console.log('playAudio called with path:', audioPath);
        currentAudio.src = audioPath;
    
        return new Promise((resolve, reject) => {
            currentAudio.onloadedmetadata = () => {
                currentAudio.play().then(() => {
                    console.log('Audio is playing:', audioPath);
                }).catch((e) => {
                    console.error("Error playing audio:", e);
                    reject(e);
                });
            };
    
            currentAudio.onended = () => {
                console.log('Audio ended:', audioPath);
                resolve();
            };
    
            currentAudio.onerror = () => {
                console.error('Error loading audio:', currentAudio.error);
                reject(currentAudio.error);
            };
        });
    }
    
    function setupNextAudioButton() {
        const nextAudioButton = document.getElementById('nextAudioButton');
        nextAudioButton.addEventListener('click', playCoaching4Audio);
        nextAudioButton.style.display = currentAudioIndex < currentCombination.length ? 'block' : 'none';
    }
    
    function setupReturnToMenuButtonCoaching4() {
        const returnButton = document.getElementById('returnButtonCoaching4');
        if (returnButton) {
            returnButton.addEventListener('click', function() {
                stopAudiosAndTimersCoaching4();
                hideUIComponents();
                const programSelect = document.getElementById('programSelect');
                if (programSelect) {
                    programSelect.selectedIndex = 0;
                    programSelect.style.display = 'block';
                }
                initiateBlinking();
                console.log("UI reset, audio stopped, and all descriptions hidden.");
    
                toggleDisplay('welcomeVideo', false);
                toggleDisplay('nextButton', false);
            });
        } else {
            console.log("Return to menu button for Coaching4 not found.");
        }
    }
    
    function setupReturnToMenuButtonCoaching3() {
        const returnButton = document.getElementById('returnButtonCoaching3');
        if (returnButton) {
            returnButton.addEventListener('click', function() {
                stopAudiosAndTimersCoaching3();
                hideUIComponents();
                const programSelect = document.getElementById('programSelect');
                if (programSelect) {
                    programSelect.selectedIndex = 0;
                    programSelect.style.display = 'block';
                }
                initiateBlinking();
                console.log("UI reset, audio stopped, and all descriptions hidden.");
            });
        } else {
            console.log("Return to menu button for Coaching3 not found.");
        }
    }
    
    function hideUIComponents() {
        const elementsToHide = ['pompesSelectorContainer', 'pompesInstruction', 'programSelect', 'retourneMenue', 'tapisImage', 'returnButtonCoaching4', 'audioDescription', 'videoDescription', 'returnButtonCoaching3'];
        elementsToHide.forEach(id => toggleDisplay(id, false));
        toggleDisplay('programSelect', true);
    }
    
    function resetSelectors(selectorIds) {
        selectorIds.forEach(selectorId => {
            const selector = document.getElementById(selectorId);
            if (selector) {
                selector.selectedIndex = 0;
            }
        });
    }
    
    function initializeCoaching4UI() {
        const videoContainer = document.getElementById('videoContainer');
        videoContainer.style.display = 'block';
        const welcomeVideo = document.getElementById('welcomeVideo');
        welcomeVideo.style.display = 'block';
    
        const videoDescription = document.getElementById('videoDescription');
        videoDescription.textContent = " Welcome to the Pushups program! Choose your way ! 36 hand positions, from 3 to 468 push-ups ";
        videoDescription.style.display = 'block';
    
        const programSelect = document.getElementById('programSelect');
        programSelect.style.display = 'none';
    
        const nextButton = document.getElementById('nextButton');
        nextButton.style.display = 'block';
        nextButton.onclick = showPompesSelector;
    
        const returnButton = document.getElementById('returnButtonCoaching4');
        if (returnButton) {
            returnButton.style.display = 'block';
        }
    }
    
    function displayNoCombinationFound() {
        const pompesInstruction = document.getElementById('pompesInstruction');
        pompesInstruction.textContent = "No combination found for the selected number of push-ups.";
        pompesInstruction.style.display = 'block';
    }
    
    function ensureNextButtonExists(container) {
        let nextButton = document.getElementById('nextButton');
        if (!nextButton && container) {
            nextButton = document.createElement('button');
            nextButton.id = 'nextButton';
            nextButton.textContent = 'Next';
            container.appendChild(nextButton);
        }
        return nextButton;
    }
    
    function createButton(id, text, container) {
        const button = document.createElement('button');
        button.id = id;
        button.textContent = text;
        container.appendChild(button);
        return button;
    }
    
    function updateButtonEventListener(button, eventHandler) {
        button.removeEventListener('click', eventHandler);
        button.addEventListener('click', eventHandler);
    }
    
    function showPompesSelector() {
        const videoContainer = document.getElementById('videoContainer');
        videoContainer.style.display = 'none';
    
        const videoDescription = document.getElementById('videoDescription');
        videoDescription.style.display = 'none';
    
        const selectorContainer = document.getElementById('pompesSelectorContainer');
        selectorContainer.style.display = 'block';
    
        const startButton = document.getElementById('startButton');
        startButton.style.display = 'none';
    
        const pompesSelector = document.getElementById('pompesSelector');
        pompesSelector.onchange = () => {};
    
        const nextAudioButton = document.getElementById('nextAudioButton');
        if (nextAudioButton) {
            nextAudioButton.style.display = 'none';
        }
    }
    
    function displayLoadingIndicator(show) {
        const indicator = document.getElementById('loadingIndicator');
        if (indicator) {
            indicator.style.display = show ? 'block' : 'none';
        }
    }
    
    function resetUI(keepSelection = false) {
        const elementsToHide = [
            'audioDescription', 'videoContainer', 'pompesSelectorContainer',
            'nextButton', 'stopButton', 'nextAudioButton', 'returnButtonCoaching4', 'startButton',
            'videoContainer2', 'welcomeVideo2', 'videoDescription2', 'nextButton2',
            'tapisImage', 'timeSelector', 'digitalDisplay', 'retourneMenue', 'startTimerButton'
        ];

        elementsToHide.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.style.display = 'none';
            }
        });
    
        if (!keepSelection) {
            const programSelect = document.getElementById('programSelect');
            if (programSelect) {
                programSelect.selectedIndex = 0;
                programSelect.style.display = 'block';
            }
        }
    
        currentAudioIndex = 0;
        isAudioPlaying = false;
    }
    


    
    function stopAudiosAndTimersCoaching4() {
        console.log('Stopping audios and timers for Coaching4...');
    
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
            console.log('General audio stopped and reset.');
        }
    
        isAudioPlaying = false;
        console.log('Scheduled audio events cleared for Coaching4.');
        console.log('Audios and timers stopped and reset for Coaching4.');
    }
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        console.log("Audio keys shuffled.");
    }
    
    shuffleArray(audioKeys);
    
    function resetTimeSelector() {
        const timeSelector = document.getElementById('timeDurationSelector');
        if (timeSelector) {
            timeSelector.selectedIndex = 0;
            console.log('Time selector reset to default.');
        } else {
            console.log('Invalid timer selection or missing time selector.');
        }
    }
    
    function stopAudiosAndTimersCoaching3() {
        console.log('Stopping audios and timers for Coaching3...');
        if (currentAudioCoaching3) {
            currentAudioCoaching3.pause();
            currentAudioCoaching3.currentTime = 0;
            console.log('Coaching3 audio stopped and reset.');
        }
        clearInterval(intervalCoaching3);
        clearTimeout(upcomingAudioTimeout);
        console.log('Timer interval cleared for Coaching3.');
        isPaused = false;
        console.log('Scheduled audio events cleared for Coaching3.');
        console.log('Audios and timers stopped and reset for Coaching3.');
    }
    
    function initializeCoaching3UI() {
        console.log("Initialisation de l'interface Coaching3");
        resetTimer();
        resetUI();
    
        const videoContainer = document.getElementById('videoContainer2');
        const welcomeVideo = document.getElementById('welcomeVideo2');
        const videoDescription = document.getElementById('videoDescription2');
        const nextButton = document.getElementById('nextButton2');
    
        if (videoContainer && welcomeVideo && videoDescription && nextButton) {
            videoContainer.style.display = 'block';
            welcomeVideo.style.display = 'block';
            videoDescription.textContent = "Welcome to the Plank program! Choose your exercise time...";
            videoDescription.style.display = 'block';
            nextButton.style.display = 'block';
            console.log("Components for Coaching3 displayed.");
        } else {
            console.log("Some elements of Coaching3 are missing in the DOM.");
        }
    }
    
    function resetTimer() {
        if (intervalCoaching3) {
            clearInterval(intervalCoaching3);
            intervalCoaching3 = null;
        }
        timerDuration = 0;
        const display = document.getElementById('digitalDisplay');
        if (display) {
            display.textContent = "00:00";
            display.classList.remove('paused');
        }
        console.log("Timer arrêté et réinitialisé.");
    }
    
    function setupNextButton2() {
        const nextButton2 = document.getElementById('nextButton2');
        if (nextButton2) {
            nextButton2.addEventListener('click', handleNextButtonClick2);
        } else {
            console.log("Le bouton 'nextButton2' n'a pas été trouvé dans le DOM.");
        }
    }
    
    function handleNextButtonClick2() {
        document.getElementById('welcomeVideo2').style.display = 'none';
        document.getElementById('videoDescription2').style.display = 'none';
        document.getElementById('nextButton2').style.display = 'none';
    
        resetTimeSelector();
    
        var timeSelector = document.getElementById('timeSelector');
        if (timeSelector) {
            timeSelector.style.display = 'block';
        } else {
            console.log("timeSelector not found in the DOM.");
        }
    
        var retourneMenue = document.getElementById('retourneMenue');
        if (retourneMenue) {
            retourneMenue.style.display = 'block';
            retourneMenue.style.marginTop = '20px';
            retourneMenue.style.margin = '0 auto';
        } else {
            console.log("retourneMenue not found in the DOM.");
        }
    }
    
    function setupTimeSelector() {
        const timeSelector = document.getElementById('timeDurationSelector');
        const startButton = document.getElementById('startTimerButton');
    
        if (timeSelector && startButton) {
            timeSelector.addEventListener('change', function() {
                if (this.value && this.value !== "") {
                    startButton.style.display = 'block';
                } else {
                    startButton.style.display = 'none';
                }
            });
        } else {
            console.log('timeDurationSelector or startTimerButton not found in the DOM.');
        }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        setupProgramSelector();
        setupRetourneMenueButton();
        setupNextButton2();
        setupStopButton();
        resetTimeSelector();
        initiateBlinking();
        setupTimeSelector();
        window.initialized = true;
    });
    
    let blinkingIntervals = [];
    
    function initiateBlinking() {
        const selectors = ['timeDurationSelector', 'programSelect', 'pompesSelector'];
    
        blinkingIntervals.forEach(interval => clearInterval(interval));
        blinkingIntervals = [];
    
        selectors.forEach(selectorId => {
            const selector = document.getElementById(selectorId);
            let isDefault = true;
    
            if (selector) {
                const blinkingInterval = setInterval(() => {
                    if (selector.value === "") {
                        if (isDefault) {
                            selector.style.backgroundColor = 'black';
                            selector.style.color = 'white';
                        } else {
                            selector.style.backgroundColor = 'white';
                            selector.style.color = 'black';
                        }
                        isDefault = !isDefault;
                    } else {
                        clearInterval(blinkingInterval);
                        selector.style.backgroundColor = 'white';
                        selector.style.color = 'black';
                    }
                }, 500);
    
                blinkingIntervals.push(blinkingInterval);
            }
        });
    }
    
    function setupRetourneMenueButton() {
        const retourneMenue = document.getElementById('retourneMenue');
        if (retourneMenue) {
            retourneMenue.addEventListener('click', function() {
                hideCoaching3Components();
                resetProgramSelector();
                stopAudiosAndTimersCoaching3();
                updateDigitalDisplay();
                resetTimeSelector();
    
                const audioDescriptionCoaching3 = document.getElementById('audioDescriptionCoaching3');
                if (audioDescriptionCoaching3) {
                    audioDescriptionCoaching3.style.display = 'none';
                }
            });
        } else {
            console.log("retourneMenue button not found in the DOM.");
        }
    }
    
    function hideCoaching3Components() {
        const elementsToHide = ['timeSelector', 'startTimerButton', 'stopButton', 'retourneMenue'];
        elementsToHide.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'none';
        });
    }
    
    function resetProgramSelector() {
        const programSelect = document.getElementById('programSelect');
        if (programSelect) {
            programSelect.style.display = 'block';
            programSelect.selectedIndex = 0;
        }
    }
    
    function updateDigitalDisplay() {
        const display = document.getElementById('digitalDisplay');
        if (display) {
            display.textContent = "00:00";
            display.style.display = 'none';
        }
    }
    
    function setupCoaching3UI() {
        console.log("Setting up Coaching3 UI...");
        document.getElementById('startTimerButton').addEventListener('click', handleStartTimer);
        document.getElementById('retourneMenue').addEventListener('click', handleReturnButtonCoaching3);
    }
    
    function handleStartTimer() {
        console.log("handleStartTimer called");
        const timeDurationSelector = document.getElementById('timeDurationSelector');
        if (timeDurationSelector && !isNaN(parseInt(timeDurationSelector.value, 10))) {
            const duration = parseInt(timeDurationSelector.value, 10);
            console.log(`Timer started for duration: ${duration} minutes.`);
    
            startVisualTimer(duration);
            playBellSoundThenCoachingAudios();
    
            const startTimerButton = document.getElementById('startTimerButton');
            const stopButton = document.getElementById('stopButton');
            const timeSelector = document.getElementById('timeSelector');
            startTimerButton.style.display = 'none';
            stopButton.style.display = 'block';
            stopButton.textContent = 'Pause';
            timeSelector.style.display = 'none';
    
            const audioDescriptionCoaching3 = document.getElementById('audioDescriptionCoaching3');
            if (audioDescriptionCoaching3) {
                const selectedAudioKey = audioKeys[audioIndex];
                audioDescriptionCoaching3.textContent = descriptions.Coaching3[selectedAudioKey];
                audioDescriptionCoaching3.style.display = 'block';
            }
        } else {
            console.log("Invalid duration or missing duration selector.");
        }
    }
    
    function playBellSoundThenCoachingAudios() {
        playBellSound();
        setTimeout(playAudioCoaching3, bellSoundBuffer.duration * 1000);
    }
    
    function playAudioCoaching3() {
        if (isPaused) {
            return;
        }
        if (audioIndex >= audioKeys.length) {
            audioIndex = 0;
            shuffleArray(audioKeys);
        }
        const selectedAudioKey = audioKeys[audioIndex++];
        currentAudioCoaching3.src = `./audio/${selectedAudioKey}.mp3`;
        currentAudioCoaching3.play();
        console.log(`Playing audio: ${selectedAudioKey}`);
    
        const audioDescriptionCoaching3 = document.getElementById('audioDescriptionCoaching3');
        if (audioDescriptionCoaching3) {
            audioDescriptionCoaching3.textContent = descriptions.Coaching3[selectedAudioKey];
            audioDescriptionCoaching3.style.display = 'block';
        }
    
        currentAudioCoaching3.onended = function() {
            console.log("Audio ended, checking if should continue...");
            if (!isPaused && timerDuration > 0) {
                upcomingAudioTimeout = setTimeout(playAudioCoaching3, 4000);
            }
        };
    }
    
    function handleReturnButtonCoaching3() {
        const programSelect = document.getElementById('programSelect');
        if (programSelect) {
            programSelect.selectedIndex = 0;
            programSelect.style.display = 'block';
        }
    
        const display = document.getElementById('digitalDisplay');
        if (display) {
            display.textContent = "00:00";
            display.style.display = 'none';
        }
        console.log("Bouton de retour géré et UI réinitialisée.");
    
        resetTimeSelector();
    }
    
    function setupReturnToMenuButton2() {
        const retourneMenue = document.getElementById('retourneMenue');
        if (retourneMenue) {
            retourneMenue.addEventListener('click', () => {
                stopAudiosAndTimersCoaching3();
                hideUIComponents();
                resetUI(true);
                console.log("Returned to the main screen and user interface reset.");
            });
        } else {
            console.log("Return button 'retourneMenue' not found in the DOM.");
        }
    }
    
    document.addEventListener('DOMContentLoaded', setupCoaching3UI);
    
    function setupStopButton() {
        let stopButton = document.getElementById('stopButton');
        if (!stopButton) {
            stopButton = document.createElement('button');
            stopButton.id = 'stopButton';
            stopButton.textContent = 'Pause';
            document.body.appendChild(stopButton);
        }
        stopButton.addEventListener('click', handlePauseResumeClick);
        stopButton.style.display = 'none';
        console.log("Configuration du bouton Stop terminée.");
    }
    
    
    function handlePauseResumeClick() {
        const stopButton = document.getElementById('stopButton');
        const retourneMenue = document.getElementById('retourneMenue');
        if (!isPaused) {
            pauseAudioAndTimer();
            stopButton.textContent = 'Resume';
            stopButton.style.backgroundColor = 'green';
            retourneMenue.style.display = 'block';
            isPaused = true;
        } else {
            resumeAudioAndTimer();
            stopButton.textContent = 'Pause';
            stopButton.style.backgroundColor = 'red';
            retourneMenue.style.display = 'none';
            isPaused = false;
        }
    }
    
    function pauseAudioAndTimer() {
        if (!currentAudioCoaching3.paused) {
            currentAudioCoaching3.pause();
        }
        if (intervalCoaching3) {
            remainingTime = timerDuration;
            clearInterval(intervalCoaching3);
            intervalCoaching3 = null;
        }
        clearTimeout(upcomingAudioTimeout);
        console.log("Audio et timer mis en pause.");
    }
    
    function resumeAudioAndTimer() {
        if (currentAudioCoaching3 && currentAudioCoaching3.paused) {
            currentAudioCoaching3.play();
            console.log("Audio resumed");
        }
        if (remainingTime > 0) {
            startVisualTimer(remainingTime / 60);
        }
    }
    
    function startVisualTimer(minutes) {
        timerDuration = minutes * 60;
        const display = document.getElementById('digitalDisplay');
        display.style.display = 'block';
    
        intervalCoaching3 = setInterval(function() {
            let minutes = Math.floor(timerDuration / 60);
            let seconds = timerDuration % 60;
            display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
            if (--timerDuration < 0) {
                clearInterval(intervalCoaching3);
                display.textContent = "00:00";
                display.style.display = 'none';
                console.log("Timer completed.");
    
                stopCurrentAudio();
                playEndOfTimerSound();
                resetTimeSelector();
                updateUIAfterTimer();
            }
        }, 1000);
    }
    
    function updateUIAfterTimer() {
        const stopButton = document.getElementById('stopButton');
        const selectOptionDiv = document.getElementById('timeSelector');
        const retourneMenue = document.getElementById('retourneMenue');
    
        if (stopButton) {
            stopButton.style.display = 'none';
        }
        if (selectOptionDiv) {
            selectOptionDiv.style.display = 'block';
        }
    
        if (retourneMenue) {
            retourneMenue.style.display = 'block';
        }
    
        resetTimeSelector();
        console.log("UI updated after timer.");
    }
    
    function stopCurrentAudio() {
        if (currentAudioCoaching3 && !currentAudioCoaching3.paused) {
            currentAudioCoaching3.pause();
            currentAudioCoaching3.currentTime = 0;
            console.log("Current audio stopped and reset.");
        }
    }
    
    function playEndOfTimerSound() {
        stopAudiosAndTimersCoaching3();
        playBellSound();
        setTimeout(updateUIAfterTimer, bellSoundBuffer.duration * 1000);
    }
    
    function stopAudiosAndTimers(resetAll = false) {
        console.log("Stopping audios and timers...");
    
        if (currentAudioCoaching3 && !currentAudioCoaching3.paused) {
            currentAudioCoaching3.pause();
            currentAudioCoaching3.currentTime = 0;
            console.log("Coaching3 audio stopped and reset.");
        }
    
        clearTimeout(upcomingAudioTimeout);
        console.log("Scheduled audio events cleared.");
    
        if (intervalCoaching3) {
            clearInterval(intervalCoaching3);
            intervalCoaching3 = null;
            console.log("Timer interval cleared.");
        }
        console.log("Audios et timers arrêtés et réinitialisés.");
        if (resetAll) {
            const timeSelector = document.getElementById('timeSelector');
            const selectedTime = timeSelector ? parseInt(timeSelector.value, 10) : 0;
            if (!isNaN(selectedTime) && selectedTime > 0) {
                timerDuration = selectedTime * 60;
                console.log("Timer reset to the user-selected time: " + selectedTime + " minutes.");
            } else {
                console.log("Invalid timer selection or missing time selector.");
            }
        }
    
        console.log("All audios and timers stopped.");
    }
    
    function handleStopClick() {
        resetUI(true);
        document.getElementById('programSelect').selectedIndex = 0;
        const stopButton = document.getElementById('stopButton');
        if (stopButton) {
            stopButton.style.display = 'none';
        }
        console.log("Processus arrêté et interface réinitialisée.");
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        setupEventListeners();
        setupCoaching3UI();
        resetTimeSelector();
        initiateBlinking();
        setupTimeSelector();
    });
    